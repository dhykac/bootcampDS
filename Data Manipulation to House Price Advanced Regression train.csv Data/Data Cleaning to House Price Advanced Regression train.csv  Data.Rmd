---
title: "Data Cleaning to House Price Advanced Regression train.csv  Data"
author: "Dhyka"
date: "12/9/2021"
output: html_document
---

# Preparation
```{r}
library(caret)
library(dplyr)
```
```{r}
df_house <- read.csv('train.csv')
head(df_house)
```
# Apabila ada data NULL maka perlu diubah menjadi NA menggunakan :
```{r}
df_house[df_house=='NULL'] <- NA
```
# Namun step ini bisa dilewati karena tidak ada data NULL pada df_house

# --- 1. Missing Value ---

# Untuk pilihan variable saya memilih 'LotFrontage' untuk di-handling
# Untuk melihat baris yang memiliki 'LotFrontage' NA menggunakan syntax
```{r}
filter_baris <- is.na(df_house$LotFrontage)
```

# Isi kolom 'LotFrontage' dengan mean (rata-rata)
```{r}
df_house[is.na(df_house$LotFrontage), 'LotFrontage'] <- mean(df_house$LotFrontage, na.rm = TRUE)
head(df_house$LotFrontage, 50)
```
# "na.rm = TRUE" berguna untuk mengabaikan nilai missing dalam perhitungan mean, agar tidak ada nilai 0 saat perhitungan sehingga rata-rata tidak == '0'.


# --- 2. Normalization / Standarization ---

# Pada soal ini saya memilih LotArea menggunakan Normalization
```{r}
norm_scaler <- preProcess(df_house['LotArea'], method = c('range'))
df_house['LotArea_norm'] <- predict(norm_scaler, df_house['LotArea'] )
head(df_house$LotArea_norm, 50)
```
# Pada step ini, LotArea_norm sudah berubah sekala dari 0~1


# --- 3. Data Transformation --- 

```{r}
hsp <- df_house$SalePrice
hist(hsp)
```
# Pastikan tidak ada nilai (-) ataupun nilai 0
```{r}
min(hsp)
```
# Karena tidak ada nilai (-) ataupun nilai 0 , maka bisa langsung menggunakan logarithm transformation
# Apabila ada nilai minimum (-), maka perlu membuat nilai absolut dengan : abs_hsp <- hsp+abs(min(hsp)) + 1
# Apabila ada nilai minimum (0), maka hanya perlu menambah nilai 1 dengan abs_hsp <- hsp+1
```{r}
hsp_trans <- log(hsp)
```

## Pada step ini, variable 'SalePrice' sudah ditransformasi menjadi sebaran mendekati normal, dan disimpan dalam bentuk hsp_trans
```{r}
hist(hsp_trans)
```
# --- 4. Outlier Handling ---

```{r}
boxplot(hsp_trans)
```
# Dikarenakan final output menggunakan data yang sudah ditransformasi sebelum dibersihkan, saya menggunakan variabel hsp_trans untuk mean, median, lowerbound dan upperbound.
```{r}
mean_hsp_trans <- mean(hsp_trans)
sd_hsp_trans <- sd(hsp_trans)
alpha_var <- 0.05
lower_bound <- qnorm(alpha_var/2,mean=mean_hsp_trans,sd = sd_hsp_trans)
upper_bound <- qnorm(1-alpha_var/2,mean=mean_hsp_trans,sd = sd_hsp_trans)
```

# Filter df_house dengan lower dan upperbound
```{r}
df_house_zd5 <- df_house[hsp_trans > lower_bound & hsp_trans < upper_bound,]
boxplot(df_house_zd5$SalePrice)
```
# Karena masih terdapat outlier, maka dicoba menaikkan alpha variance menjadi 0.15 (15%)
```{r}
alpha_var <- 0.15
lower_bound <- qnorm(alpha_var/2,mean=mean_hsp_trans,sd = sd_hsp_trans)
upper_bound <- qnorm(1-alpha_var/2,mean=mean_hsp_trans,sd = sd_hsp_trans)
df_house_zd15 <- df_house[hsp_trans > lower_bound & hsp_trans < upper_bound,]
boxplot(df_house_zd15$SalePrice)
```
# Pada step ini, outlier sudah hilang
```{r}
head(df_house_zd15$SalePrice, 50)
```


# --- 5. Data Categorical Handling ---

## Untuk soal ini, saya menggunakan kolom 'Utilities' untuk variable dengan metode One-Hot Encoding. Pada step ini kita menggunakan dataframe yang sudah terfilter dari outlier pada nomor 1-4
```{r}
head(df_house_zd15$Utilities, 100)
```
```{r}
dummy <- dummyVars("~.",data=df_house_zd15['Utilities'])
dummy_var <- data.frame(predict(dummy, newdata = df_house_zd15['Utilities']))
df_house_enc <- cbind(df_house_zd15,dummy_var)
head((df_house_enc[c("UtilitiesAllPub", "UtilitiesNoSeWa")]), 50)
```
# --- Final Output ---

## Variable Missing Value = "LotFrontage"
## Variable Normalization = "LotArea_norm"
## Variable Transformation & Outlier Handling = "SalePrice" menggunakan dataframe terakhir "df_house_enc"
## Variable One Hot Encoding = "UtilitiesAllPub" & "UtilitiesNoSeWa"
```{r}
df_output = df_house_enc[, c("LotFrontage","LotArea_norm","SalePrice","UtilitiesAllPub","UtilitiesNoSeWa")]
df_output
```






