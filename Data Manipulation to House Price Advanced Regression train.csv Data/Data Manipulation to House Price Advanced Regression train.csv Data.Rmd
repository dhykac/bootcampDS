---
title: "Data Manipulation to House Price Advanced Regression train.csv Data"
author: "Dhyka"
date: "11/14/2021"
output: html_document
---

# Preparation
```{r}
library(tidyverse)
library(readr)
train = read.csv("train.csv", header=T, na.strings='')
head(train)
```

# 1.Pilih kolom ID, Condition1, OverallCond, YearBuilt, dan FullBath yang mana GrLivArea nya = 1717 atau 2324, jelaskan fungsi apa yang akan digunakan dan kenapa?

```{r}
train %>%
  
#Kita akan melakukan filter pada GrLivArea menggunakan fungsi filter() dengan kondisi GrLivArea == 1717 atau GrLivArea == 2324
  filter(GrLivArea== 1717 | GrLivArea == 2324) %>%
  
#Dan terakhir kita akan menggunakan fungsi select() untuk memilih 5 kolom yang diinginkan, yaitu Id,Condition1,OverallCond,YearBuilt, dan FullBath
  select(Id,Condition1,OverallCond,YearBuilt,FullBath)
```



# 2.Pada tahun berapa yang paling banyak membangun rumah dimana GarageCond: Garage condition = Ex Excellent?
```{r}
#Pertama yang perlu dilakukan adalah mencari kapan saja rumah dengan GarageCond Ex dibangun menggunakan fungsi yang dipakai di nomor 1.
train %>%
  filter(GarageCond == 'Ex') %>%
  select(YearBuilt)

#Setelah itu, kita mengetahui bahwa rumah dengan GarageCond Ex dibangun 2 kali pada tahun yang berbeda, yaitu 1940 dan 1959

#Langkah selanjutnya adalah menghitung jumlah rumah yang dibangun pada tahun yang sama
train %>%
  filter(YearBuilt == 1940 | YearBuilt == 1959) %>%

#Untuk mempermudah, kita akan mengelompokkan data sesuai dengan tahun dibangun (YearBuilt) menggunakan fungsi group_by()
  
#Setelah itu, kita jumlahkan row data untuk rumah sesuai dengan YearBuilt yang sama dengan rumah GarageCond == EX sesuai dengan pengelompokkan tadi menggunakan fungsi summarise()
  group_by(YearBuilt) %>% 
  summarise(count_gcEX = n()) %>%  
  
#Terakhir, kita urutkan data yang sudah dihitung dari yang terbesar hingga terkecil menggunakan fungsi arrange()
  arrange(desc(count_gcEX))
  
#Kesimpulannya, jumlah rumah terbanyak yang dibangun pada tahun yang sama dengan "GarageCond == Ex" adalah pada YearBuilt tahun 1959 dengan total jumlah dibangun 26 rumah
```



# 3.Rata-rata penjualan rumah tertinggi pada tahun berapa?
```{r}
#Pertama kita akan melakukan groupby() menggunakan var YrSold
train %>%
  group_by(YrSold) %>%
  
#Selanjutnya, kita akan summarise() data menggunakan Mean dari harga jual dan jumlah rumah yang terjual pada tahun tersebut
  summarise(MeanSalePrice=mean(SalePrice), HouseSoldPerYear=n()) %>%

#Terakhir, dirurutkan dengan arrange()
  arrange(desc(MeanSalePrice))
  
#Kesimpulannya rata-rata penjualan rumah tertinggi ada pada tahun 2007 dengan jumlah 329 rumah.
```



# 4.Apakah YearBuilt dan YearRemodAdd di tahun yang sama mempunyai penjualan yang tinggi?
```{r}
#Pertama, kita akan mencari rumah yang tidak mengalami modifikasi sejak tahun pembuatannya (YearBuilt == YearRemodAdd)
sameYear=train %>%
  filter(YearBuilt==YearRemodAdd) %>%
  select(SalePrice) %>%
  summarise_all(funs(n=n(),mean=mean(.),standdev=sd(.)))

sameYear #Dapat disimpulkan bahwa rumah yang tidak mengalami perubahan ada 764 rumah dengan rata-rata harga jual 182583.
```
```{r}
#Selanjutnya kita akan membandingkan dengan rumah yang mengalami modifikasi sejak tahun pembuatannya (YearBuilt != YearRemodAdd)
diffYear=train %>%
  filter(YearBuilt!=YearRemodAdd) %>%
  select(SalePrice) %>%
  summarise_all(funs(n=n(),mean=mean(.),standdev=sd(.)))
diffYear

#Berdasarkan perbedaan tersebut, maka dapat disimpulkan bahwa ketika YearBuilt == YearRemodAdd (rumah tidak mengalami modifikasi) mempunyai penjualan yang tinggi jika dibandingkan dengan YearBuilt != YearRemodAdd (rumah mengalami modifikasi)
```



# 5.Buat kolom baru dengan nama Usia_Rumah setelah YearRemodeAll
```{r}
#Pertama kita buat data yang kita buat menjadi data fram untuk mempermudah pengerjaan
df.train = train

#Selanjutnya tambahkan kolom yang diinginkan dengan menggunakan fungsi mutate() terhadap dataframe yang baru dibuat. Tambahkan juga kondisi dan .after() untuk penyesuaian dengan soal.
mutate(df.train, HouseAgeYear = YrSold-YearBuilt, .after = YearRemodAdd)

```



# 6.Buatlah Feature Engineering dari kolom YearBuilt, OverallQual, YearRemodAll, YrSold, dan MoSold minimal 10 feature baru
```{r}
#Pertama, kita buat dataframe lain yang berisi kolomkolom yang diinginkan
df.train6 = select(df.train, YearBuilt, OverallQual, YearRemodAdd, YrSold, MoSold)
head(df.train6)
```
```{r}
#Sebelum menambahkan kolom, buat fungsi-fungsi yang akan digunakan nanti saat penambahan

what_season=function(x){
  if (x %in% c(12,1,2)){
    return('Winter')
  }
  else if(x %in% c(3:5)){
    return('Spring')
  }
  else if(x %in% c(6:8)){
    return('Summer')
  }
  else{
    return('Fall')
  }
}
what_season_v=Vectorize(what_season)

what_cat=function(x){
  if (x %in% c(6:10)){
    return('Good')
  }
  else if(x %in% c(1:4)){
    return('Poor')
  }
  else{
    return('Average')
  }
}
what_cat_v=Vectorize(what_cat)

what_cent=function(x){
  if (x %in% c(2000:2100)){
    return('21')
  }
  else if(x %in% c(1900:1999)){
    return('20')
  }
  else{
    return('19')
  }
}
what_cent_v=Vectorize(what_cent)

when_sent=function(x){
  if (x %in% c(5:6)){
    return('July 1st')
  }
  else if(x %in% c(8:9)){
    return('October 1st')
  }
  else if(x %in% c(11:12)){
    return('January 1st')
  }
  else{
    return('April 1st')
  }
}
when_sent_v=Vectorize(when_sent)

when_due=function(x){
  if (x %in% c(5:6)){
    return('August 1st')
  }
  else if(x %in% c(8:9)){
    return('November 1st')
  }
  else if(x %in% c(11:12)){
    return('February 1st')
  }
  else{
    return('May 1st')
  }
}
when_due_v=Vectorize(when_due)



#Feature pertama, HouseYearAge (YrSold-YearBuilt). Yaitu usia total rumah dari pembangunan hingga dijual dalam tahun
df.train6 %>%
  mutate(df.train6, HouseAgeYear = YrSold-YearBuilt) %>%
  
#Feature kedua, HouseMoAge (((YrSold-YearBuilt)/12)+MoSold). Yaitu usia total dari pembangunan hingga dijual dalam bulan.
  mutate(df.train6, HouseAgeMo = (((YrSold-YearBuilt)*12)+MoSold)) %>%

#Feature ketiga, yeartoremodel (YearRemodAdd - YearBuilt). Yaitu usia rumah sebelum modifikasi (original appearance)
  mutate(df.train6, YearToRemodel = YearRemodAdd - YearBuilt) %>%

#Feature keempat, Recommendation (ifelse OverallQual >= 5, "Recommended", "Not Recommended"). yaitu memberikan rekomendasi apakah rumah tersebut layak dibeli apabila index OverallQual nya average keatas dimana 1 artinya recommended, 0 artinya 0 recommended
  mutate(df.train6, Recommendation = ifelse(OverallQual >=5, 'Recommended', 'Not Recommended')) %>%
  
#Feature kelima, Still Original (ifelse YearBuilt == YearRemodAdd, 1, 0). Yaitu memberikan informasi apakah rumah tersebut masih dalam keadaan original tanpa modifikasi (1) atau telah mengalami modifikasi (0)
  mutate(df.train6, StillOriginal = ifelse(YearBuilt == YearRemodAdd, 1, 0)) %>%

#Feature keenam, Season Sold (what_season function) , yaitu musim apa rumah tersebut terjual berdasarkan MoSold
  mutate(df.train6, SeasonSold = what_season_v(MoSold)) %>%

#Feature ketujuh, QualCat (what_cat function) , yaitu kategori apa rumah tersebut berdasarkan OverallQual
  mutate(df.train6, QualCat = what_cat_v(OverallQual)) %>%

#Feature ketujuh, Century (what_cent function) , yaitu abad berapa rumah tersebut dibangun berdasarkan YearBuilt
  mutate(df.train6, Century = what_cent_v(YearBuilt)) %>%

#Feature kedelapan, TaxBillSent (when_sent function) , yaitu kapan tagihan pajak selanjutnya akan dikirim setelah rumah terjual
  mutate(df.train6, TaxBillSent = when_sent_v(MoSold)) %>%

#Feature kesembilan, TaxBillDue (when_due function) , yaitu kapan tagihan pajak selanjutnya akan jatuh tempo setelah rumah terjual
  mutate(df.train6, TaxBillDue = when_due_v(MoSold)) %>%

#Feature Kesepuluh, ShortSale (YearBuilt == YrSold), yaitu memberikan informasi apakah rumah tersebut short sale atau dijual pada tahun yang sama dengan saat rumah dibangun
  mutate(df.train6, ShortSale = ifelse(YearBuilt == YrSold, "Yes", "No"))

```
